language: c++
cache: ccache

os:
  osx:
    compiler:
     - clang 
  linux:
    compiler:
     - gcc

compiler:
  - clang

addons:
  mariadb: '10.2'

install:
  - if [ $TRAVIS_OS_NAME = linux ]; then sudo apt-get install libv8; else brew install v8; fi
script: 
  - mkdir build
  - cd build
  - cmake .. 
  - make 
  - make install
  - cd ..
  - mkdir release
  - tar -czvf release/mysql-js-$TRAVIS_OS_NAME-x64-release.tar.gz build/libmysql-js.so deps/v8/icudtl.dat deps/v8/natives_blob.bin  deps/v8/snapshot_blob Loader.js script.js


deploy:
  provider: s3
  access_key_id: $AWS_ACCESS_KEY_ID
  secret_access_key: $AWS_SECRET_ACCESS_KEY
  bucket: $AWS_S3_BUCKET
  skip_cleanup: true
  local_dir: release
  region: $AWS_S3_REGION